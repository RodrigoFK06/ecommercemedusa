import{K as g}from"./chunk-6HTZNHPT-CCbEU0M9.js";import{R as d,u as y}from"./chunk-ZCO6EK4W-DoT7MNjv.js";import{R as _,aS as v,j as e,b as N,d0 as C,a8 as k,w as S,t as p,B as j,H as w,v as r,I as F,aa as E,ab as H,ac as o}from"./index-DykHJelC.js";import"./prompt-D23W5bh3.js";var M=o.object({labels:o.array(o.object({tracking_number:o.string(),tracking_url:o.string().optional(),label_url:o.string().optional()})),send_notification:o.boolean().optional()});function R({order:c,fulfillment:i}){const{t:s}=N(),{handleSuccess:u}=y(),{mutateAsync:x,isPending:h}=C(c.id,i==null?void 0:i.id),a=k({defaultValues:{send_notification:!c.no_notification},resolver:H(M)}),{fields:m,append:f}=S({name:"labels",control:a.control}),b=a.handleSubmit(async l=>{var t;await x({items:(t=i==null?void 0:i.items)==null?void 0:t.map(n=>({id:n.line_item_id,quantity:n.quantity})),labels:l.labels.filter(n=>!!n.tracking_number).map(n=>({tracking_number:n.tracking_number,tracking_url:"#",label_url:"#"})),no_notification:!l.send_notification},{onSuccess:()=>{p.success(s("orders.shipment.toastCreated")),u(`/orders/${c.id}`)},onError:n=>{p.error(n.message)}})});return e.jsx(d.Form,{form:a,children:e.jsxs(g,{onSubmit:b,className:"flex h-full flex-col overflow-hidden",children:[e.jsx(d.Header,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(d.Close,{asChild:!0,children:e.jsx(j,{size:"small",variant:"secondary",children:s("actions.cancel")})}),e.jsx(j,{size:"small",type:"submit",isLoading:h,children:s("actions.save")})]})}),e.jsx(d.Body,{className:"flex h-full w-full flex-col items-center divide-y overflow-y-auto",children:e.jsx("div",{className:"flex size-full flex-col items-center overflow-auto p-16",children:e.jsx("div",{className:"flex w-full max-w-[736px] flex-col justify-center px-2 pb-2",children:e.jsxs("div",{className:"flex flex-col divide-y",children:[e.jsxs("div",{className:"flex flex-1 flex-col",children:[e.jsx(w,{className:"mb-4",children:s("orders.shipment.title")}),m.map((l,t)=>e.jsx(r.Field,{control:a.control,name:`labels.${t}.tracking_number`,render:({field:n})=>e.jsxs(r.Item,{className:"mb-4",children:[t===0&&e.jsx(r.Label,{children:s("orders.shipment.trackingNumber")}),e.jsx(r.Control,{children:e.jsx(F,{...n,placeholder:"123-456-789"})}),e.jsx(r.ErrorMessage,{})]})},l.id)),e.jsx(j,{type:"button",onClick:()=>f({tracking_number:""}),className:"self-end",variant:"secondary",children:s("orders.shipment.addTracking")})]}),e.jsx("div",{className:"mt-8 pt-8 ",children:e.jsx(r.Field,{control:a.control,name:"send_notification",render:({field:{onChange:l,value:t,...n}})=>e.jsxs(r.Item,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(r.Label,{children:s("orders.shipment.sendNotification")}),e.jsx(r.Control,{children:e.jsx(r.Control,{children:e.jsx(E,{checked:!!t,onCheckedChange:l,...n})})})]}),e.jsx(r.Hint,{className:"!mt-1",children:s("orders.shipment.sendNotificationHint")}),e.jsx(r.ErrorMessage,{})]})})})]})})})})]})})}function B(){var m;const{id:c,f_id:i}=_(),{order:s,isLoading:u,isError:x,error:h}=v(c,{fields:"*fulfillments,*fulfillments.items,*fulfillments.labels"});if(x)throw h;const a=!u&&s;return e.jsx(d,{children:a&&e.jsx(R,{order:s,fulfillment:(m=s.fulfillments)==null?void 0:m.find(f=>f.id===i)})})}export{B as Component};
